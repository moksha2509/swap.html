<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ğŸ’± CashSwap â€” Your Campus Exchange</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <!-- Bootstrap Icons -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --csw-bg: linear-gradient(135deg, #6dd5ed, #2193b0);
      --csw-card: rgba(255, 255, 255, 0.95);
      --csw-text: #222;
      --csw-muted: #555;
      --csw-accent: #ff9800;
      --csw-accent-2: #ff5f6d;
    }

    body {
      background: var(--csw-bg);
      color: var(--csw-text);
      min-height: 100vh;
      font-family: "Segoe UI", system-ui, sans-serif;
      margin: 0;
      padding: 0;
    }

    /* Navbar */
    .navbar {
      background: #ffffff !important;
      padding: 0.8rem 1.2rem;
      box-shadow: 0 2px 6px rgba(0,0,0,0.08);
    }
    .navbar-brand,
    .navbar-text,
    .navbar-nav .nav-link {
      color: var(--csw-text) !important;
      font-weight: 600;
    }

    /* Cards */
    .csw-card {
      background: var(--csw-card);
      border: none;
      border-radius: 12px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.12);
      padding: 1.5rem;
      max-width: 500px;
      margin: 1rem auto;
    }

    /* Form fields */
    .form-control, .form-select {
      background-color: #fff;
      color: var(--csw-text);
      border: 1px solid rgba(0,0,0,0.15);
      border-radius: 8px;
      padding: 8px;
      margin-bottom: 12px;
      font-size: 1rem;
    }

    /* Accent button */
    .btn-accent {
      background: linear-gradient(90deg, var(--csw-accent), var(--csw-accent-2));
      border: none;
      color: #fff;
      font-weight: bold;
      border-radius: 8px;
      padding: 10px;
      width: 100%;
      cursor: pointer;
      box-shadow: 0 3px 8px rgba(0,0,0,0.2);
    }
    .btn-accent:hover {
      opacity: 0.9;
    }

    /* Contact button */
    .btn-contact {
      background: #4cafef;
      color: white !important;
      font-weight: 600;
      border-radius: 20px;
      padding: 6px 14px;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .btn-contact:hover {
      background: #3797e0;
    }

    /* Clear all button */
    .btn-clear {
      background: #ff5f6d;
      color: white !important;
      font-weight: 600;
      border-radius: 20px;
      padding: 6px 14px;
      border: none;
      display: inline-flex;
      align-items: center;
      gap: 5px;
      cursor: pointer;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    }
    .btn-clear:hover {
      background: #e14c58;
    }

    /* Chips */
    .csw-chip {
      background: rgba(0,0,0,0.05);
      color: var(--csw-text);
      padding: 4px 10px;
      border-radius: 20px;
    }

    /* Request items */
    .request-item {
      background: var(--csw-card);
      padding: 10px;
      margin-top: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.08);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    /* Section headings */
    h5 {
      font-weight: bold;
      color: var(--csw-text);
    }
  </style>
</head>
<body>
  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg sticky-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="#">
        <i class="bi bi-cash-coin fs-3 text-success"></i>
        <span class="fw-bold fs-4">ğŸ’± CashSwap</span>
      </a>
      <span class="navbar-text tagline">ğŸ“ Your Campus Exchange</span>
      <div class="ms-auto d-flex gap-2">
        <button id="btnClearAll" class="btn btn-clear btn-sm">
          <i class="fa fa-times"></i> Clear All
        </button>
        <button id="btnSeed" class="btn btn-outline-success btn-sm">
          <i class="fa fa-seedling"></i> Demo Data
        </button>
      </div>
    </div>
  </nav>

  <!-- Main -->
  <main class="container py-4 py-lg-5">
    <div class="row g-4">
      <!-- Form -->
      <section class="col-lg-4">
        <div class="card csw-card p-3 p-md-4">
          <div class="card-body">
            <h5 class="card-title mb-3">â• Post a New Request</h5>
            <form id="requestForm" novalidate>
              <div class="mb-3">
                <label for="amount" class="form-label">ğŸ’° Amount (â‚¹)</label>
                <div class="input-group">
                  <span class="input-group-text">â‚¹</span>
                  <input type="number" min="1" step="1" class="form-control" id="amount" placeholder="500" required>
                </div>
                <div class="invalid-feedback">Enter a valid amount (â‚¹1+).</div>
              </div>

              <div class="row g-2 mb-3">
                <div class="col-6">
                  <label class="form-label">ğŸ‘œ I Have</label>
                  <select class="form-select" id="have" required>
                    <option value="" selected disabled>Chooseâ€¦</option>
                    <option value="Cash">ğŸ’µ Cash</option>
                    <option value="UPI">ğŸ“² UPI</option>
                  </select>
                </div>
                <div class="col-6">
                  <label class="form-label">ğŸ“¥ I Need</label>
                  <select class="form-select" id="need" required>
                    <option value="" selected disabled>Chooseâ€¦</option>
                    <option value="Cash">ğŸ’µ Cash</option>
                    <option value="UPI">ğŸ“² UPI</option>
                  </select>
                </div>
              </div>

              <div class="mb-3">
                <label for="contact" class="form-label">ğŸ“ Contact Number</label>
                <input type="text" class="form-control" id="contact" placeholder="Contact Number" required>
              </div>

              <div class="mb-3">
                <label for="details" class="form-label">ğŸ“ Additional Details</label>
                <textarea id="details" class="form-control" rows="3" placeholder="ğŸ“ Near library â€¢ â° 2 PM"></textarea>
              </div>

              <div class="d-grid">
                <button type="submit" class="btn btn-accent fw-semibold">
                  <i class="fa fa-plus"></i> Post Request
                </button>
              </div>
            </form>
          </div>
        </div>
        <div class="mt-3 small text-muted">
          ğŸ”’ Pro tip: Meet in public & verify payment before confirming.
        </div>
      </section>

      <!-- Requests -->
      <section class="col-lg-8">
        <div class="d-flex align-items-center justify-content-between mb-2">
          <h5 class="m-0">ğŸ“‹ Current Exchange Requests</h5>
          <div class="d-flex gap-2">
            <input id="searchInput" class="form-control form-control-sm" placeholder="ğŸ” Searchâ€¦" />
            <select id="filterSelect" class="form-select form-select-sm">
              <option value="all" selected>All</option>
              <option value="Cash->UPI">ğŸ’µ â†’ ğŸ“²</option>
              <option value="UPI->Cash">ğŸ“² â†’ ğŸ’µ</option>
            </select>
          </div>
        </div>
        <div id="requestsContainer" class="row g-3"></div>
        <div id="emptyState" class="text-center py-5 list-empty d-none">
          ğŸ“­ No requests yet. Be the first to post!
        </div>
      </section>
    </div>
  </main>

  <!-- Footer -->
  <footer class="border-top border-secondary-subtle py-4">
    <div class="container d-flex flex-wrap align-items-center justify-content-between footer">
      <div>ğŸ’± <span class="fw-semibold">CashSwap</span> â€¢ Campus cash/UPI board</div>
    </div>
  </footer>

  <!-- Contact Modal -->
  <div class="modal fade" id="contactModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content bg-dark text-light border-secondary">
        <div class="modal-header">
          <h6 class="modal-title">ğŸ“‡ Contact Request</h6>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body" id="contactModalBody"></div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="position-fixed bottom-0 end-0 p-3">
    <div id="toastSaved" class="toast text-bg-success border-0">
      <div class="d-flex">
        <div class="toast-body">ğŸ‰ Request posted!</div>
        <button type="button" class="btn-close btn-close-white m-auto" data-bs-dismiss="toast"></button>
      </div>
    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    const LS_KEY = 'cashswap_requests_v1';
    let requests = [];
    const fmtINR = (n) => new Intl.NumberFormat('en-IN', { style:'currency', currency:'INR', maximumFractionDigits:0 }).format(n);
    const iconFor = (type) => type === 'Cash' ? 'ğŸ’µ' : 'ğŸ“²';
    const makeId = () => Date.now().toString(36) + Math.random().toString(36).slice(2,8);

    function loadRequests() {
      requests = JSON.parse(localStorage.getItem(LS_KEY) || '[]');
    }

    function saveRequests() {
      localStorage.setItem(LS_KEY, JSON.stringify(requests));
    }

    function escapeHtml(str) {
      return str.replace(/[&<>"]/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;'}[c]));
    }

    function renderRequests() {
      const container = document.getElementById('requestsContainer');
      const empty = document.getElementById('emptyState');
      container.innerHTML = '';

      const q = document.getElementById('searchInput').value.trim().toLowerCase();
      const f = document.getElementById('filterSelect').value;
      let list = [...requests];
      if (f === 'Cash->UPI') list = list.filter(r => r.have === 'Cash' && r.need === 'UPI');
      if (f === 'UPI->Cash') list = list.filter(r => r.have === 'UPI' && r.need === 'Cash');
      if (q) list = list.filter(r => (r.details || '').toLowerCase().includes(q) || (r.contact || '').toLowerCase().includes(q));

      if (list.length === 0) {
        empty.classList.remove('d-none');
        return;
      }
      empty.classList.add('d-none');
      list.sort((a, b) => b.createdAt - a.createdAt);

      list.forEach(r => {
        container.innerHTML += `
          <div class="col-12">
            <div class="card csw-card p-0">
              <div class="card-body d-flex flex-column flex-md-row align-items-md-center justify-content-between gap-3">
                <div class="d-flex align-items-center gap-3">
                  <div class="display-6 lh-1">${iconFor(r.have)}</div>
                  <div>
                    <div class="fw-semibold">${fmtINR(r.amount)}</div>
                    <div class="small text-secondary">ğŸ•’ ${new Date(r.createdAt).toLocaleString()}</div>
                  </div>
                </div>
                <div class="d-flex flex-wrap gap-2">
                  <span class="csw-chip">âœ… Has ${r.have}</span>
                  <span class="csw-chip">â¡ï¸ Needs ${r.need}</span>
                  ${r.details ? `<span class="csw-chip">ğŸ“ ${escapeHtml(r.details)}</span>` : ''}
                  ${r.contact ? `<span class="csw-chip">ğŸ“ ${escapeHtml(r.contact)}</span>` : ''}
                </div>
                <div class="d-flex gap-2">
                  <button class="btn btn-contact btn-sm" data-action="contact" data-id="${r.id}">
                    <i class="fa fa-envelope"></i> Contact
                  </button>
                  <button class="btn btn-outline-danger btn-sm" data-action="delete" data-id="${r.id}">
                    <i class="fa fa-trash"></i>
                  </button>
                </div>
              </div>
            </div>
          </div>`;
      });
    }

    document.getElementById('requestForm').addEventListener('submit', e => {
      e.preventDefault();
      const form = e.currentTarget;
      if (!form.checkValidity()) {
        form.classList.add('was-validated');
        return;
      }

      const amount = parseInt(document.getElementById('amount').value, 10);
      const have = document.getElementById('have').value;
      const need = document.getElementById('need').value;
      const contact = document.getElementById('contact').value.trim();
      const details = document.getElementById('details').value.trim();

      if (have === need) return alert('âš ï¸ "I Have" and "I Need" cannot be the same.');
      if (!Number.isFinite(amount) || amount < 1) return alert('âš ï¸ Invalid amount.');
      if (!contact) return alert('âš ï¸ Contact number is required.');

      requests.push({ id: makeId(), amount, have, need, contact, details, createdAt: Date.now() });
      saveRequests();
      renderRequests();
      form.reset();
      form.classList.remove('was-validated');
      new bootstrap.Toast(document.getElementById('toastSaved')).show();
    });

    document.getElementById('requestsContainer').addEventListener('click', e => {
      const btn = e.target.closest('button[data-action]');
      if (!btn) return;
      const id = btn.dataset.id;
      const action = btn.dataset.action;
      const req = requests.find(r => r.id === id);
      if (!req) return;

      if (action === 'contact') {
        document.getElementById('contactModalBody').innerHTML = `
          <p>ğŸ“¢ Demo only â€” no real contact shared.</p>
          <ul>
            <li><strong>ğŸ’° Amount:</strong> ${fmtINR(req.amount)}</li>
            <li><strong>âœ… Has:</strong> ${req.have}</li>
            <li><strong>â¡ï¸ Needs:</strong> ${req.need}</li>
            <li><strong>ğŸ“ Contact:</strong> ${escapeHtml(req.contact)}</li>
            ${req.details ? `<li><strong>ğŸ“ Details:</strong> ${escapeHtml(req.details)}</li>` : ''}
          </ul>
          <hr><p class="small text-secondary">ğŸ’¡ Tip: Share contact via campus chat safely.</p>`;
        new bootstrap.Modal('#contactModal').show();
      }

      if (action === 'delete') {
        if (confirm('ğŸ—‘ï¸ Remove this request?')) {
          requests = requests.filter(r => r.id !== id);
          saveRequests();
          renderRequests();
        }
      }
    });

    document.getElementById('filterSelect').addEventListener('change', renderRequests);
    document.getElementById('searchInput').addEventListener('input', renderRequests);
    document.getElementById('btnClearAll').addEventListener('click', () => {
      if (requests.length === 0) return alert('Nothing to clear.');
      if (confirm('âš ï¸ Delete all saved requests?')) {
        requests = [];
        saveRequests();
        renderRequests();
      }
    });

    document.getElementById('btnSeed').addEventListener('click', () => {
      const sample = [
        { amount: 500, have: 'Cash', need: 'UPI', contact: '9876543210', details: 'Near Library â€¢ 2â€“3 PM' },
        { amount: 1200, have: 'UPI', need: 'Cash', contact: '9123456789', details: 'Cafeteria â€¢ Can break change' },
        { amount: 300, have: 'Cash', need: 'UPI', contact: '9988776655', details: 'Hostel A Gate' },
      ].map(x => ({ id: makeId(), createdAt: Date.now() - Math.random() * 3600000, ...x }));
      requests = [...sample, ...requests];
      saveRequests();
      renderRequests();
    });

    document.getElementById('amount').addEventListener('input', function () {
      let value = this.value.replace(/,/g, '');
      if (!isNaN(value) && value.length > 0) {
        this.value = parseInt(value, 10);
      }
    });

    (function init() {
      loadRequests();
      renderRequests();
    })();
  </script>
</body>
</html>